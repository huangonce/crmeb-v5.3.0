(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{482:function(t,e,n){var content=n(580);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("fba27a1c",content,!0,{sourceMap:!1})},579:function(t,e,n){"use strict";n(482)},580:function(t,e,n){var o=n(2)((function(i){return i[1]}));o.push([t.i,".user-index .user-content[data-v-b11609d4]{padding:34px 0}.user-index .user-content .item[data-v-b11609d4]{border-bottom:1px dashed #ddd;font-size:14px;margin-right:54px;padding-left:16px;position:relative}.user-index .user-content .item .edit-txt[data-v-b11609d4]{bottom:16px;color:#e93323;cursor:pointer;position:absolute;right:0}.user-index .user-content .item .label[data-v-b11609d4]{color:#777;display:inline-block;width:80px}.user-index .user-content .item.user-info[data-v-b11609d4]{padding-bottom:20px}.user-index .user-content .item.user-info .title[data-v-b11609d4]{color:#282828;font-size:18px}.user-index .user-content .item.user-info .info[data-v-b11609d4]{color:#777;font-size:14px;margin-top:20px}.user-index .user-content .item.user-info .info img[data-v-b11609d4]{border-radius:50%;display:inline-block;height:80px;vertical-align:-44px;width:80px}.user-index .user-content .item.text-info[data-v-b11609d4]{height:70px;line-height:70px}.user-index .user-content .item.text-info .edit-txt[data-v-b11609d4]{top:0}.user-index .user-content .item.text-info .txt[data-v-b11609d4]{color:#282828;width:700px}.user-index .user-content .out-btn[data-v-b11609d4]{margin-right:54px;text-align:right}.user-index .user-content .out-btn span[data-v-b11609d4]{background:#e93323;border-radius:4px;color:#fff;cursor:pointer;display:inline-block;height:40px;line-height:40px;margin-top:38px;text-align:center;width:130px}.input-item[data-v-b11609d4]{align-items:center;display:flex;margin-bottom:20px}.input-item .code-box[data-v-b11609d4]{cursor:pointer;height:40px;margin-left:30px;text-align:center;width:115px}.dialog-footer[data-v-b11609d4]{align-items:center;border-top:1px solid #efefef;display:flex;justify-content:center;padding-top:40px}.dialog-footer button[data-v-b11609d4]{height:45px;width:190px}.user-header[data-v-b11609d4]:hover{transform:rotate(666turn);transition:all 59s cubic-bezier(.34,0,.84,1) 1s}",""]),o.locals={},t.exports=o},639:function(t,e,n){"use strict";n.r(e);n(237),n(7);var o=n(111),r=n.n(o),c=n(4),d=(n(238),n(155)),l=n.n(d),h=(n(44),n(19),n(468)),f=n(493),v=n(67),x={name:"index",auth:"guest",components:{Verify:f.a},mixins:[h.a],data:function(){return{userInfo:{},fileList:[],upLoadUrl:v.a.apiBaseURL+"/upload/image",myHeaders:{},isPassword:!1,verifyModal:!1,passwordData:{phone:"",code:"",newPassword:""},isPhone:!1,phoneData:{code:"",newPhone:""},keyCode:"",modalType:0}},fetch:function(t){var e=t.store;e.commit("isHeader",!0),e.commit("isFooter",!0)},head:function(){return{title:"账户管理-"+this.$store.state.titleCon}},created:function(){},mounted:function(){var t=this.$cookies.get("auth.strategy");this.myHeaders={Authorization:this.$cookies.get("auth._token.".concat(t))},this.userInfo=this.$auth.user,this.getCodeKey()},methods:{getVerify:function(t){var e=this;this.verifyModal=!0,this.modalType=t,this.$nextTick((function(t){e.$refs.verify.show()}))},success:function(t){this.getCode(t)},getCodeKey:function(){var t=this;this.$axios.$get("/verify_code").then((function(e){t.keyCode=e.key}))},handleSuccess:function(data){var t=this;if(400==data.status)return this.$message.error(data.msg);this.$axios.post("user/edit",{avatar:data.data.url,nickname:this.userInfo.nickname}).then((function(e){var n=JSON.parse(JSON.stringify(t.userInfo));n.avatar=data.data.url,t.$auth.$storage.setUniversal("user",n),t.userInfo=t.$auth.user,t.$message.success("修改成功")})).catch((function(t){}))},handleExceed:function(t,e){this.$message.warning("请勿频繁重复上传")},handleError:function(t,e){this.$message.error("上传失败")},editName:function(){var t=this;l.a.prompt("请输入昵称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"昵称不能为空"}).then((function(e){var n=e.value;t.$axios.post("user/edit",{nickname:n,avatar:t.userInfo.avatar}).then((function(e){var o=JSON.parse(JSON.stringify(t.userInfo));o.nickname=n,t.$auth.$storage.setUniversal("user",o),t.userInfo=t.$auth.user,t.$message.success("修改成功")}))})).catch((function(){}))},longOut:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.$cookies.get("auth.strategy"),e.next=3,t.$auth.logout(n).then((function(e){t.$store.commit("cartNum",0),t.$router.replace({path:"/"})}));case 3:case"end":return e.stop()}}),e)})))()},bindPassword:function(){var t=this,e=this;return e.passwordData.code?e.passwordData.newPassword?void this.$axios.post("register/reset",{account:e.userInfo.phone,captcha:e.passwordData.code,password:e.passwordData.newPassword}).then((function(e){r.a.success(e.msg),t.isPassword=!1,t.passwordData.phone="",t.passwordData.code="",t.passwordData.newPassword=""})).catch((function(t){return r.a.error(t)})):r.a.error("请填写新密码"):r.a.error("请填写验证码")},handleClose:function(){this.isPassword=!1,this.isPhone=!1,this.passwordData.phone="",this.passwordData.code="",this.passwordData.newPassword="",this.phoneData.code="",this.phoneData.newPhone=""},getCode:function(data){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,e.next=3,t.$axios.post("/register/verify",{phone:n.modalType?n.phoneData.newPhone:n.userInfo.phone,type:"mobile",key:n.keyCode,captchaType:"blockPuzzle",captchaVerification:data.captchaVerification}).then((function(t){r.a.success(t.msg),n.sendCode()})).catch((function(t){r.a.error(t)}));case 3:case"end":return e.stop()}}),e)})))()},bindNewPhone:function(){var t=this;return Object(c.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t).phoneData.newPhone){e.next=3;break}return e.abrupt("return",r.a.error("请填写新手机号码"));case 3:if(/^1(3|4|5|7|8|9|6)\d{9}$/i.test(n.phoneData.newPhone)){e.next=5;break}return e.abrupt("return",r.a.error("请输入正确的手机号码"));case 5:if(n.phoneData.code){e.next=7;break}return e.abrupt("return",r.a.error("请填写验证码"));case 7:t.$axios.post("user/updatePhone",{phone:n.phoneData.newPhone,captcha:n.phoneData.code,key:n.keyCode}).then((function(e){r.a.success(e.msg),t.userInfo.phone=n.phoneData.newPhone,t.isPhone=!1,t.phoneData.newPhone="",t.phoneData.code=""})).catch((function(t){return r.a.error(t)}));case 8:case"end":return e.stop()}}),e)})))()}}},m=(n(579),n(16)),component=Object(m.a)(x,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"user-index"},[e("div",{staticClass:"user-com-title",staticStyle:{"padding-left":"16px"}},[t._v("账户管理")]),t._v(" "),e("div",{staticClass:"user-content"},[e("div",{staticClass:"item user-info"},[e("div",{staticClass:"info"},[e("span",{staticClass:"label"},[t._v("我的头像：")]),t._v(" "),e("img",{staticClass:"user-header",attrs:{src:t.userInfo.avatar,alt:""}})]),t._v(" "),e("div",{staticClass:"edit-txt"},[e("el-upload",{staticClass:"upload-demo",attrs:{action:t.upLoadUrl,"on-success":t.handleSuccess,"show-file-list":!1,multiple:!1,limit:3,"on-exceed":t.handleExceed,"on-error":t.handleError,headers:t.myHeaders,"file-list":t.fileList}},[t._v("\n          修改\n        ")])],1)]),t._v(" "),e("div",{staticClass:"item text-info"},[e("span",{staticClass:"label"},[t._v("我的昵称：")]),t._v(" "),e("span",{staticClass:"txt line1",staticStyle:{display:"inline-block","vertical-align":"middle"}},[t._v(t._s(t.userInfo.nickname))]),t._v(" "),e("div",{staticClass:"edit-txt",on:{click:t.editName}},[t._v("修改")])]),t._v(" "),e("div",{staticClass:"item text-info"},[e("span",{staticClass:"label"},[t._v("手机号：")]),t._v(" "),e("span",{staticClass:"txt"},[t._v(t._s(t.userInfo.phone))]),t._v(" "),e("div",{staticClass:"edit-txt",on:{click:function(e){t.isPhone=!0}}},[t._v("修改")])]),t._v(" "),e("div",{staticClass:"item text-info"},[e("span",{staticClass:"label"},[t._v("我的ID：")]),t._v(" "),e("span",{staticClass:"txt"},[t._v(t._s(t.userInfo.uid))])]),t._v(" "),e("div",{staticClass:"item text-info"},[e("span",{staticClass:"label"},[t._v("密码设置：")]),t._v(" "),e("span",{staticClass:"txt"},[t._v("******")]),t._v(" "),e("div",{staticClass:"edit-txt",on:{click:function(e){t.isPassword=!0}}},[t._v("修改密码")])]),t._v(" "),e("div",{staticClass:"out-btn"},[e("span",{on:{click:t.longOut}},[t._v("退出登录")])])]),t._v(" "),e("el-dialog",{attrs:{title:"修改密码",visible:t.isPassword,width:"545px","before-close":t.handleClose},on:{"update:visible":function(e){t.isPassword=e}}},[e("div",{staticClass:"form-box"},[e("div",{staticClass:"input-item"},[e("el-input",{attrs:{placeholder:"请输入手机号码",disabled:""},model:{value:t.userInfo.phone,callback:function(e){t.$set(t.userInfo,"phone",e)},expression:"userInfo.phone"}},[e("template",{slot:"prepend"},[t._v("+86")])],2)],1),t._v(" "),e("div",{staticClass:"input-item"},[e("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.passwordData.code,callback:function(e){t.$set(t.passwordData,"code",e)},expression:"passwordData.code"}}),t._v(" "),e("el-button",{staticClass:"code-box",attrs:{plain:"",disabled:t.disabled},on:{click:function(e){return t.getVerify(0)}}},[t._v(t._s(t.text)+"\n        ")])],1),t._v(" "),e("div",{staticClass:"input-item"},[e("el-input",{attrs:{placeholder:"请输入新密码",type:"password"},model:{value:t.passwordData.newPassword,callback:function(e){t.$set(t.passwordData,"newPassword",e)},expression:"passwordData.newPassword"}})],1)]),t._v(" "),e("div",{staticClass:"dialog-footer"},[e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.bindPassword}},[t._v("确 定")]),t._v(" "),e("el-button",{on:{click:t.handleClose}},[t._v("取 消")])],1)])]),t._v(" "),e("el-dialog",{attrs:{title:"修改手机号码",visible:t.isPhone,width:"545px","before-close":t.handleClose},on:{"update:visible":function(e){t.isPhone=e}}},[e("div",{staticClass:"form-box"},[e("div",{staticClass:"input-item"},[e("el-input",{attrs:{placeholder:"请输入新手机号码"},model:{value:t.phoneData.newPhone,callback:function(e){t.$set(t.phoneData,"newPhone",e)},expression:"phoneData.newPhone"}},[e("template",{slot:"prepend"},[t._v("+86")])],2)],1),t._v(" "),e("div",{staticClass:"input-item"},[e("el-input",{attrs:{placeholder:"请输入验证码"},model:{value:t.phoneData.code,callback:function(e){t.$set(t.phoneData,"code",e)},expression:"phoneData.code"}}),t._v(" "),e("el-button",{staticClass:"code-box",attrs:{plain:"",disabled:t.disabled},on:{click:function(e){return t.getVerify(1)}}},[t._v(t._s(t.text)+"\n        ")])],1)]),t._v(" "),e("div",{staticClass:"dialog-footer"},[e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.bindNewPhone}},[t._v("确 定")]),t._v(" "),e("el-button",{on:{click:t.handleClose}},[t._v("取 消")])],1)])]),t._v(" "),t.verifyModal?e("Verify",{ref:"verify",attrs:{captchaType:"blockPuzzle",imgSize:{width:"330px",height:"155px"}},on:{success:t.success}}):t._e()],1)}),[],!1,null,"b11609d4",null);e.default=component.exports}}]);